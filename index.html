<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sensor Monitoring System</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Loading indicator -->
    <div
      id="loadingIndicator"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #0a0a0a;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: #00d4ff;
        font-family: Arial, sans-serif;
      "
    >
      <div style="text-align: center">
        <div
          style="
            width: 50px;
            height: 50px;
            border: 3px solid #00d4ff;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
          "
        ></div>
        <h2>Loading Sensor Monitoring System...</h2>
        <p>Mohon tunggu sebentar</p>
      </div>
    </div>

    <!-- Fallback content if JavaScript fails -->
    <noscript>
      <div
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: #1a1a2e;
          color: #ff3b30;
          padding: 2rem;
          border-radius: 10px;
          border: 2px solid #ff3b30;
          text-align: center;
          font-family: Arial, sans-serif;
          z-index: 9999;
        "
      >
        <h2>❌ JavaScript Required</h2>
        <p>Website ini membutuhkan JavaScript untuk berfungsi.</p>
        <p>Silakan aktifkan JavaScript di browser Anda.</p>
      </div>
    </noscript>

    <!-- Temperature Info Section (Initial View) -->
    <div id="temperatureInfoSection" class="temperature-info-section">
      <div class="temp-info-container">
        <div class="temp-info-header">
          <i class="fas fa-thermometer-half"></i>
          <h1>Sensor Monitoring System</h1>
          <p>Real-time temperature monitoring</p>
        </div>

        <div class="temp-info-content">
          <div class="current-temp-display">
            <div class="temp-value">
              <span id="initialTempValue">--</span>
              <span class="temp-unit">°C</span>
            </div>
            <div class="temp-label">Current Temperature</div>
            <div class="temp-source" id="initialTempSource">Loading...</div>
          </div>

          <div class="temp-status">
            <div class="status-indicator" id="initialStatusIndicator">
              <i class="fas fa-circle"></i>
              <span id="initialStatusText">Initializing...</span>
            </div>
          </div>
        </div>

        <div class="temp-info-footer">
          <div class="last-update">
            <i class="fas fa-clock"></i>
            <span id="initialLastUpdate">Last update: --</span>
          </div>
        </div>
      </div>

      <!-- Login Button (Bottom Right) -->
      <button
        id="showLoginBtn"
        class="floating-login-btn"
        onclick="showLoginModal()"
      >
        <i class="fas fa-sign-in-alt"></i>
        <span>Login</span>
      </button>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal hidden">
      <div class="modal-content">
        <div class="login-header">
          <i class="fas fa-shield-alt"></i>
          <h2>Login Monitoring</h2>
          <p>Masuk ke sistem monitoring sensor</p>
        </div>

        <form id="loginForm" class="login-form">
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="email" placeholder="Email" />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Password" />
          </div>
          <button type="submit" class="login-btn">
            <span>Masuk</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </form>

        <div class="demo-credentials">
          <p>Demo: admin@sensor.com / admin123</p>
        </div>

        <div class="auth-switch">
          <p>
            Belum punya akun?
            <a href="#" onclick="showRegisterModal()">Daftar di sini</a>
          </p>
        </div>
      </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal hidden">
      <div class="modal-content">
        <div class="login-header">
          <i class="fas fa-user-plus"></i>
          <h2>Registrasi Operator</h2>
          <p>Buat akun baru untuk monitoring sensor</p>
        </div>

        <form id="registerForm" class="login-form">
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input
              type="text"
              id="regName"
              placeholder="Nama Lengkap"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="regEmail" placeholder="Email" required />
          </div>
          <div class="input-group">
            <i class="fas fa-phone"></i>
            <input
              type="tel"
              id="regTelp"
              placeholder="Nomor Telepon"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="regPassword"
              placeholder="Password"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="regConfirmPassword"
              placeholder="Konfirmasi Password"
              required
            />
          </div>
          <button type="submit" class="login-btn">
            <span>Daftar</span>
            <i class="fas fa-user-plus"></i>
          </button>
        </form>

        <div class="auth-switch">
          <p>
            Sudah punya akun?
            <a href="#" onclick="showLoginModal()">Login di sini</a>
          </p>
        </div>
      </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard hidden">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <i class="fas fa-satellite-dish"></i>
          <h1>Sensor Monitoring System</h1>
        </div>
        <div class="header-right">
          <div class="user-info">
            <span id="userName">Admin</span>
            <button id="logoutBtn" class="logout-btn">
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
          <button
            id="backToTempBtn"
            class="back-to-temp-btn"
            onclick="showTemperatureInfoSection()"
            title="Kembali ke tampilan suhu"
          >
            <i class="fas fa-thermometer-half"></i>
            <span>View Temp</span>
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-thermometer-half"></i>
            </div>
            <div class="stat-content">
              <h3>Total Sensor</h3>
              <p id="totalSensors">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
              <h3>Data Hari Ini</h3>
              <p id="todayData">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-database"></i>
            </div>
            <div class="stat-content">
              <h3>Total Data</h3>
              <p id="totalData">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
              <h3>Status</h3>
              <p id="systemStatus" class="status-badge status-normal">Normal</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <h3>Update Terakhir</h3>
              <p id="lastUpdate">-</p>
            </div>
          </div>
        </div>

        <!-- Cooling System Control Section -->
        <div class="control-section">
          <div class="control-header">
            <h3><i class="fas fa-snowflake"></i> Cooling System Control</h3>
            <p>Control the cooling system based on sensor readings</p>
          </div>

          <!-- Audio elements for alerts -->
          <audio id="temperatureAlert" preload="auto">
            <source
              src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT"
              type="audio/wav"
            />
          </audio>

          <!-- Temperature Alert Banner -->
          <div id="temperatureAlertBanner" class="alert-banner hidden">
            <div class="alert-content">
              <i class="fas fa-exclamation-triangle"></i>
              <span class="alert-text"
                >⚠️ SUHU KRITIS! Aktifkan sistem pendingin sekarang!</span
              >
              <button id="acknowledgeAlert" class="acknowledge-btn">
                <i class="fas fa-check"></i> Acknowledge
              </button>
            </div>
          </div>
          <div class="control-grid">
            <div class="control-card">
              <div class="control-icon">
                <i class="fas fa-thermometer-half"></i>
              </div>
              <div class="control-content">
                <h4>Current Temperature</h4>
                <p id="currentTemp">--°C</p>
                <span class="temp-source"
                  >From: <span id="tempSource">--</span></span
                >
              </div>
            </div>
            <div class="control-card">
              <div class="control-icon">
                <i class="fas fa-snowflake"></i>
              </div>
              <div class="control-content">
                <h4>Cooling System</h4>
                <div class="toggle-switch-container">
                  <label class="toggle-switch">
                    <input
                      type="checkbox"
                      id="coolingToggle"
                      onchange="toggleCoolingSystem(this)"
                    />
                    <span class="slider"></span>
                  </label>
                  <span class="toggle-label" id="coolingStatus">OFF</span>
                </div>
                <p class="control-description">
                  Manual control of the cooling system
                </p>

                <!-- Threshold Information -->
                <div class="threshold-info">
                  <div class="threshold-item">
                    <span class="threshold-label">Min:</span>
                    <span class="threshold-value">Loading...</span>
                  </div>
                  <div class="threshold-item">
                    <span class="threshold-label">Max:</span>
                    <span class="threshold-value">Loading...</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="control-card">
              <div class="control-icon">
                <i class="fas fa-info-circle"></i>
              </div>
              <div class="control-content">
                <h4>System Status</h4>
                <p id="coolingSystemStatus" class="status-badge status-normal">
                  Idle
                </p>
                <p class="control-description">
                  Real-time system status and alerts
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
          <div class="chart-container">
            <div class="chart-header">
              <h3>Monitoring Real-time</h3>
              <div class="chart-controls">
                <button id="acuanBakuBtn" onclick="openAcuanBakuModal()">
                  <i class="fas fa-cog"></i>
                  Acuan Baku
                </button>
                <button id="refreshBtn" onclick="refreshData()">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button
                  id="refreshAcuanBtn"
                  onclick="forceRefreshAcuanBakuLines()"
                  title="Refresh Acuan Baku Lines"
                >
                  <i class="fas fa-redo"></i>
                  Refresh Lines
                </button>
                <button
                  id="testRegisterBtn"
                  onclick="testRegistration()"
                  title="Test Registration Process"
                  style="
                    background: rgba(255, 59, 48, 0.1);
                    border-color: rgba(255, 59, 48, 0.3);
                    color: #ff3b30;
                  "
                >
                  <i class="fas fa-bug"></i>
                  Test Register
                </button>
                <select id="timeRange">
                  <option value="1">1 Jam</option>
                  <option value="6">6 Jam</option>
                  <option value="12">12 Jam</option>
                  <option value="24">24 Jam</option>
                </select>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="sensorChart"></canvas>
            </div>

            <!-- Chart Legend -->
            <div class="chart-legend" id="chartLegend">
              <div class="legend-item">
                <div class="legend-color" style="background: #00d4ff"></div>
                <span>Nilai Sensor</span>
              </div>
              <!-- Acuan baku legend will be populated here -->
            </div>
          </div>
        </div>

        <!-- Data Table -->
        <div class="table-section">
          <div class="table-header">
            <h3>Data Sensor Terbaru</h3>
            <div class="table-controls">
              <input
                type="text"
                id="searchInput"
                placeholder="Cari sensor..."
                class="search-input"
              />
              <select id="sensorFilter" class="sensor-select">
                <option value="">Semua Sensor</option>
              </select>
            </div>
          </div>
          <div class="table-container">
            <table id="sensorTable" class="sensor-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nama Sensor</th>
                  <th>Tanggal</th>
                  <th>Nilai</th>
                  <th>Waktu</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="sensorTableBody">
                <!-- Data will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Memuat data...</p>
      </div>
    </div>

    <!-- Acuan Baku Modal -->
    <div id="acuanBakuModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Kelola Acuan Baku</h2>
          <button class="modal-close" onclick="closeAcuanBakuModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <!-- Acuan Baku List -->
          <div class="acuan-list-section">
            <div class="section-header">
              <h3>Daftar Acuan Baku Saat Ini</h3>
              <button class="btn-primary" onclick="showAddAcuanForm()">
                <i class="fas fa-plus"></i> Tambah Baru
              </button>
            </div>

            <div id="acuanBakuList" class="acuan-list">
              <!-- Acuan baku items will be populated here -->
            </div>
          </div>

          <!-- Add/Edit Form -->
          <div id="acuanForm" class="acuan-form hidden">
            <h3 id="formTitle">Tambah Acuan Baku Baru</h3>

            <form id="acuanBakuForm" onsubmit="handleAcuanBakuSubmit(event)">
              <input type="hidden" id="acuanId" value="" />

              <div class="form-group">
                <label for="acuanMin">Nilai Minimum (°C):</label>
                <input type="number" id="acuanMin" step="0.1" required />
              </div>

              <div class="form-group">
                <label for="acuanMax">Nilai Maksimum (°C):</label>
                <input type="number" id="acuanMax" step="0.1" required />
              </div>

              <div class="form-group">
                <label for="acuanStatus">Status (Opsional):</label>
                <input
                  type="text"
                  id="acuanStatus"
                  placeholder="Contoh: Normal, Waspada, Bahaya"
                />
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary">
                  <i class="fas fa-save"></i> Simpan
                </button>
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="cancelAcuanForm()"
                >
                  <i class="fas fa-times"></i> Batal
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanelModal" class="modal hidden">
      <div class="modal-content">
        <div class="login-header">
          <i class="fas fa-users-cog"></i>
          <h2>Admin Panel</h2>
          <p>Kelola status user dan akses sistem</p>
        </div>

        <div class="admin-content">
          <div class="admin-section">
            <h3>Daftar User</h3>
            <div id="userList" class="user-list">
              <!-- User list will be populated here -->
            </div>
          </div>

          <div class="admin-section">
            <h3>Ubah Status User</h3>
            <form id="updateStatusForm" class="admin-form">
              <div class="input-group">
                <i class="fas fa-user"></i>
                <select id="updateUserId" required>
                  <option value="">Pilih User</option>
                </select>
              </div>
              <div class="input-group">
                <i class="fas fa-user-tag"></i>
                <select id="updateUserStatus" required>
                  <option value="">Pilih Status</option>
                  <option value="Umum">Umum</option>
                  <option value="Admin">Admin</option>
                  <option value="Supervisor">Supervisor</option>
                </select>
              </div>
              <button type="submit" class="login-btn">
                <span>Update Status</span>
                <i class="fas fa-save"></i>
              </button>
            </form>
          </div>
        </div>

        <div class="modal-actions">
          <button onclick="closeAdminPanel()" class="btn-secondary">
            <i class="fas fa-times"></i>
            Tutup
          </button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
